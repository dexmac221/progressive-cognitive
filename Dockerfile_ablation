
FROM pytorch/pytorch:2.4.0-cuda12.1-cudnn9-runtime

WORKDIR /app

# Fix for libgomp
ENV OMP_NUM_THREADS=1

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
RUN pip install huggingface_hub numpy

# Copy evaluation scripts
COPY evaluation_framework.py .
COPY run_ablation_study.py .

# Run a dummy HTTP server in the background to pass Hugging Face health check (port 7860)
# and run the ablation study in the foreground
CMD python -m http.server 7860 & python run_ablation_study.py
